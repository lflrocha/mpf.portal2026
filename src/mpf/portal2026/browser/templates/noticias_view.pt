<tal:root
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="context/main_template/macros/master"
>

  <metal:main fill-slot="main">
    <main id="main-content" class="w-full">
      <div class="mx-auto max-w-[1440px] px-4 py-6 sm:py-8"
           tal:define="data view/results">

        <!-- HERO + FORM -->
        <header class="rounded-md border border-gray-300 bg-white overflow-hidden">
          <div class="relative overflow-hidden">
            <div class="absolute inset-0 bg-[color:var(--brand)]"></div>
            <div class="absolute inset-0 opacity-15"
                 style="background-image:
                   radial-gradient(circle at 20% 20%, rgba(255,255,255,.8), transparent 55%),
                   radial-gradient(circle at 80% 30%, rgba(255,255,255,.6), transparent 55%);"
                 aria-hidden="true"></div>

            <div class="relative p-4 sm:p-6 md:p-7 text-white">
              <p class="text-[11px] font-semibold uppercase tracking-wider text-white/90">
                Sala de imprensa
              </p>
              <h1 class="mt-1 text-2xl sm:text-3xl font-semibold leading-tight">
                NotÃ­cias
              </h1>
              <p class="mt-1 text-sm text-white/90 max-w-3xl">
                Filtre por unidade â€” e encontre rapidamente o que vocÃª precisa.
              </p>
            </div>
          </div>

          <div class="p-4 sm:p-6 md:p-7 border-t border-white/15 bg-white">
            <form class="grid gap-3 lg:grid-cols-12"
                  role="search"
                  aria-label="Buscar notÃ­cias"
                  method="get"
                  tal:attributes="action request/URL">

              <!-- Busca -->
              <div class="lg:col-span-6">
                <label for="news-search" class="text-xs font-semibold text-gray-700">Buscar</label>
                <div class="mt-1 relative">
                  <span aria-hidden="true" class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">ðŸ”Ž</span>
                  <input id="news-search"
                         name="q"
                         type="search"
                         placeholder="Palavra-chaveâ€¦"
                         class="w-full rounded-md border border-gray-300 bg-white pl-10 pr-3 py-2.5 text-sm
                                focus:outline-none focus:ring-2 focus:ring-[color:var(--brand)]/30"
                         tal:attributes="value view/q" />
                </div>
              </div>

              <!-- Tema -->
              <div class="lg:col-span-3">
                <label for="news-tema" class="text-xs font-semibold text-gray-700">Categoria</label>
                <div class="mpf-select mt-1 text-gray-700">
                  <select id="news-tema"
                          name="tema"
                          class="w-full rounded-md border border-gray-300 bg-white px-3 py-2.5 text-sm
                                 focus:outline-none focus:ring-2 focus:ring-[color:var(--brand)]/30">
                                 <tal:opts tal:repeat="opt view/temas_options">
                                   <option
                                       tal:define="val python:opt[0]; label python:opt[1]"
                                       tal:attributes="value val;
                                                       selected python:(val and val == view.tema()) or (not val and not view.tema())"
                                       tal:content="label">Todas</option>
                                 </tal:opts>
                  </select>
                </div>
              </div>

              <!-- Ordenar -->
              <div class="lg:col-span-3">
                <label for="news-sort" class="text-xs font-semibold text-gray-700">Ordenar</label>
                <div class="mpf-select mt-1 text-gray-700">
                  <select id="news-sort"
                          name="sort"
                          class="w-full rounded-md border border-gray-300 bg-white px-3 py-2.5 text-sm
                                 focus:outline-none focus:ring-2 focus:ring-[color:var(--brand)]/30">
                    <option value="recentes"
                            tal:attributes="selected python:request.get('sort','recentes')=='recentes'">Mais recentes</option>
                    <option value="antigas"
                            tal:attributes="selected python:request.get('sort','recentes')=='antigas'">Mais antigas</option>

                  </select>
                </div>
              </div>

              <!-- Unidade (hidden, preenchida por clique no aside ou select mobile) -->
              <input type="hidden" name="unidade" id="unidade-hidden"
                     tal:attributes="value python:request.get('unidade','')" />

              <div class="lg:col-span-12 mt-2 border-t border-gray-200 pt-4"></div>

              <div class="lg:col-span-12 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                <p class="text-xs text-gray-600">
                  Mostrando <span class="font-semibold" tal:content="data/total">0</span> notÃ­cias
                </p>

                <div class="flex items-center gap-2 sm:justify-end">
                  <button type="submit"
                          class="inline-flex items-center justify-center rounded-md bg-[color:var(--brand)] px-4 py-2.5 text-xs sm:text-sm font-semibold text-white
                                 hover:opacity-95 focus:outline-none focus:ring-2 focus:ring-[color:var(--brand)]/30">
                    Filtrar
                  </button>
                </div>
              </div>
            </form>
          </div>
        </header>

        <!-- GRID PRINCIPAL -->
        <section class="mt-4 sm:mt-6 grid gap-6 lg:grid-cols-12 lg:items-start">

          <!-- ASIDE: Unidades (desktop) -->


          <!-- RESULTADOS -->
          <div class="lg:col-span-8">
            <section class="rounded-md border border-gray-300 bg-white overflow-hidden">
              <header class="p-4 sm:p-6 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900">Resultados</h2>
                <p class="mt-1 text-sm text-gray-600">
                  <tal:cond tal:condition="python: view.q() or view.tema() or view.unidade()">
                    Exibindo resultados filtrados.
                  </tal:cond>
                  <tal:cond tal:condition="python: not (view.q() or view.tema() or view.unidade())">
                    Exibindo todas as notÃ­cias.
                  </tal:cond>
                </p>
              </header>

              <div class="p-4 sm:p-6">
                <div id="news-results" class="news-results is-list">

                  <tal:empty tal:condition="python:not data['items']">
                    <p class="text-sm text-gray-700">Nenhuma notÃ­cia encontrada com os filtros informados.</p>
                  </tal:empty>

                  <tal:item tal:repeat="it python:data['items']">
                    <article class="news-item group rounded-md border border-gray-200 bg-white overflow-hidden"
                             tal:attributes="data-origin it/origin;
                                             data-category it/tema_id;
                                             data-datetime it/datetime_iso">

                      <div class="news-media" tal:condition="it/image_url">
                        <img tal:attributes="src it/image_url"
                             alt="Imagem da notÃ­cia"
                             loading="lazy" />
                      </div>

                      <div class="p-5">
                        <p class="text-xs font-semibold uppercase tracking-wider text-[color:var(--brand)]"
                           tal:content="it/tema">Geral</p>

                        <h3 class="mt-2 text-base font-semibold leading-snug text-gray-900">
                          <a tal:attributes="href it/url"
                             class="hover:underline focus:outline-none focus:ring-2 focus:ring-[color:var(--brand)]/30 rounded"
                             tal:content="it/title">TÃ­tulo</a>
                        </h3>

                        <p class="mt-2 text-sm text-gray-700 leading-relaxed line-clamp-3"
                           tal:content="it/description">DescriÃ§Ã£o</p>

                        <div class="mt-3 text-xs text-gray-500" tal:content="it/origin">/portal/pgr</div>
                        <div class="mt-1 text-xs text-gray-500 inline-flex items-center gap-2" tal:condition="it/datetime_human">
                          <span aria-hidden="true">ðŸ•’</span>
                          <time data-role="datetime" tal:content="it/datetime_human">18/12/2025 â€¢ 14:32</time>
                        </div>
                      </div>
                    </article>
                  </tal:item>

                </div>
              </div>
            </section>

            <!-- PaginaÃ§Ã£o -->
            <tal:pagination tal:define="pages data/pages; p data/page"
                            tal:condition="python: pages > 1">
              <nav class="mt-6 flex items-center justify-center" aria-label="PaginaÃ§Ã£o">
                <div class="rounded-md border border-gray-300 bg-white px-4 py-3 text-sm text-gray-700 flex items-center gap-3">
                  <a tal:condition="python: p>1"
                     tal:attributes="href python:view.build_url(page=p-1)"
                     class="hover:underline">Anterior</a>

                  <span class="font-medium text-gray-900"
                        tal:content="python:'PÃ¡gina %s de %s' % (p, pages)">PÃ¡gina</span>

                  <a tal:condition="python: p<pages"
                     tal:attributes="href python:view.build_url(page=p+1)"
                     class="hover:underline">PrÃ³ximo</a>
                </div>
              </nav>
            </tal:pagination>

          </div>
        </section>
      </div>
    </main>

    <!-- JS leve pra clique em unidade jogar no hidden e submeter -->
    <script type="text/javascript">
      (function(){
        function $(sel){ return document.querySelector(sel); }
        function $all(sel){ return Array.prototype.slice.call(document.querySelectorAll(sel)); }

        var hidden = $("#unidade-hidden");
        var form = $("#main-content form[role='search']");
        if (!hidden || !form) return;

        $all("[data-unidade]").forEach(function(a){
          a.addEventListener("click", function(ev){
            ev.preventDefault();
            hidden.value = a.getAttribute("data-unidade") || "";
            form.submit();
          });
        });
      })();
    </script>

  </metal:main>
</tal:root>
